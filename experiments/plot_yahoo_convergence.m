load('/Users/matt/Dropbox (MIT)/research/submodular-networked-control/submodular-saddle-point/submodular_multi_online/data_from_cluster/all_local_yahoo_data/f5eb9839-e66c-4eee-bbf8-cb70a97c45c1.mat');

figure('Units','inches', ...
    'Position',[0 0 3.25 0.9], ...
    'PaperPositionMode', 'auto');
set(gcf, 'Renderer', 'painters'); % so that it is vector graphics

%% convergence plot with dual bound
ax1 = axes;
niters = length(out_struct_max.Fval_hist);
plot(ax1, 1:niters, out_struct_max.Fval_hist, 'LineWidth', 2); hold on;
plot(ax1, 1:niters, out_struct_max.dual_bound, 'LineWidth', 2); hold on;
axis(ax1, [0 niters 4600 5200]);
set(ax1,...
        'Units','normalized',... %YTick...
        'YTick',4600:300:5200,...
        'XTick',0:15:30,...,
        'FontUnits','points',...
        'FontWeight','normal',...
        'FontSize',6,...
        'FontName','Times');
xlabel(ax1, 'Iterations',...
        'FontUnits','points',...
        'interpreter','latex',...
        'FontSize',6,...
        'FontName','Times');
ylabel(ax1, 'Influence',...
        'FontUnits','points',...
        'interpreter','latex',...
        'FontSize',6,...
        'FontName','Times');
legend(ax1, {'p', 'd'},...
        'FontUnits','points',...
        'interpreter','latex',...
        'Location','northeast',...
        'FontSize',6,...
        'FontName','Times');
    
set(subplot(1,3,1,ax1));

%% convergence plot with dual bound
ax2 = axes;
niters = length(out_struct_max.Fval_hist);
plot(ax2, 1:niters, log10(out_struct_max.dual_gap), 'LineWidth', 2); hold on;
axis(ax2, [0 niters 0 3]);
set(ax2,...
        'Units','normalized',... %YTick...
        'XTick',0:15:30,...
        'FontUnits','points',...
        'FontWeight','normal',...
        'FontSize',6,...
        'FontName','Times');
xlabel(ax2, 'Iterations',...
        'FontUnits','points',...
        'interpreter','latex',...
        'FontSize',6,...
        'FontName','Times');
ylabel(ax2, 'Log dual gap',...
        'FontUnits','points',...
        'interpreter','latex',...
        'FontSize',6,...
        'FontName','Times');
    
set(subplot(1,3,2,ax2));

%% convergence plot with dual bound
xhigh_bound = cellfun(@(x) x.xmin_high_bound, out_struct_max.constrained_certified_suboptimality_gap);
lagrangian_bound = cellfun(@(x) x.lagrangian_bound, out_struct_max.constrained_certified_suboptimality_gap);
lagrangian_bound_discrete = cellfun(@(x) x.lagrangian_bound_discrete, out_struct_max.constrained_certified_suboptimality_gap);


xhigh_bound = max(0, xhigh_bound);
lagrangian_bound = max(0, lagrangian_bound);
lagrangian_bound_discrete = max(0, lagrangian_bound_discrete);

ax3 = axes;

edges = 0:1e-3:1e-2;
histogram(ax3, xhigh_bound, edges); hold on; 
histogram(ax3, lagrangian_bound_discrete, edges);
%plot(ax3, 1:niters, log10(out_struct_max.dual_gap), 'LineWidth', 2); hold on;
%axis(ax3, [0 niters 0 3]);
set(ax3,...
        'Units','normalized',... %YTick...
        'FontUnits','points',...
        'FontWeight','normal',...
        'FontSize',6,...
        'FontName','Times');
xlabel(ax3, 'Suboptimality',...
        'FontUnits','points',...
        'interpreter','latex',...
        'FontSize',6,...
        'FontName','Times');
ylabel(ax3, 'Frequency',...
        'FontUnits','points',...
        'interpreter','latex',...
        'FontSize',6,...
        'FontName','Times');
legend(ax3, {'$x$', 'L'},...
        'FontUnits','points',...
        'interpreter','latex',...
        'Location','northeast',...
        'FontSize',6,...
        'FontName','Times');
    
set(subplot(1,3,3,ax3));

% have to render as opengl or other raster because of transparency
%print(gcf, '-opengl','-depsc','../plots/yahoo-convergence-analysis.eps')